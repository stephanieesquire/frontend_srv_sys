<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!--estilos-->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./assets/css/styles.css" />

    <title>encuesta</title>
  </head>
  <body>
    <div>
      <!--menu-->
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <div>
                <a href="index.html">
                  <img class="logo" src="./assets/images/logo.png" alt="logo" />
                </a>
              </div>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="principal.html"
                  >Encuestas</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Resumen</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!--titulo-->
      <div class="container">
        <div>
          <h3 class="mencuesta-title">Nueva pregunta</h3>
          <!-- dependiendo el modo, mostrar h3 nueva/modificar -->
        </div>
        <!--pregunta-->
        <div class="container box-encuesta div-pregunta rounded">
          <div id="div-pregunta">
            <div class="form-group">
              <label>Texto</label>
              <textarea
                id="texto-pregunta"
                class="form-control"
                rows="3"
              ></textarea>
            </div>
            <div class="form-group">
              <label>Tipo de respuesta</label>
              <select
                class="form-control control-select"
                id="tipo-respuesta"
                onchange="mostrarTextRespuestas()"
              >
                <option value="L">Libre</option>
                <option value="MO">Múltiple opción</option>
              </select>
            </div>
            <div id="guardar_pregunta">
              <a href="preguntas.html">
                <!-- <a> -->
                <img
                  src="./assets/images/check.svg"
                  alt="guardar_pregunta"
                  class="add-icon"
                  onclick="savePregunta()"
                />
              </a>
              <span class="text-add">Guardar pregunta</span>
              <br />
            </div>
          </div>
          <!--respuesta-->
          <div id="div-respuesta" class="div-respuesta">
            <div class="form-group">
              <label>Texto de respuesta esperada</label>
              <input id="texto-respuesta" class="form-control" />
            </div>
            <div id="guardar-respuesta">
              <img
                src="./assets/images/check.svg"
                alt="agregar_respuesta"
                id="agregar_respuesta"
                class="add-icon"
                onclick="saveRespuesta()"
              />
              <span class="text-add">Guardar respuesta</span>
            </div>
          </div>
          <div id="add-respuesta">
            <img
              src="./assets/images/add.svg"
              alt="agregar_respuesta"
              id="agregar_respuesta"
              class="add-icon"
              onclick="mostrarTextRespuestas()"
            />
            <span class="text-add">Agregar respuesta</span>
          </div>
          <!-- visor respuestas agregadas -->
          <div id="visor-respuestas">
            <!-- <div class="respuesta-ingresada rounded"> -->
              <!-- <span class="respuesta-ingresada-span"></span>  -->
              <!-- <img id="remove-answer" class="remove-answer" src="./assets/images/remove.svg" alt="quitar" onclick="removeAnswer()"> -->
            <!-- </div> -->
          </div>
        </div>
      </div>
    </div>

    <footer>
      
    </footer>
  </body>
</html>

<!-- un poco de onda -->
<script>
  //flag respuesta mo
  var mo = "off";
  sessionStorage.setItem("flagMo", mo);

  document.getElementById("div-respuesta").style.display = "none";
  document.getElementById("add-respuesta").style.display = "none";

  function mostrarTextRespuestas() {
    var combo = document.getElementById("tipo-respuesta");
    var tipo_seleccionado = combo.options[combo.selectedIndex].value;
    document.getElementById("guardar_pregunta").style.display = "none";

    if (tipo_seleccionado == "MO") {
      document.getElementById("div-respuesta").style.display = "initial";
      document.getElementById("add-respuesta").style.display = "none";
    }

    if (tipo_seleccionado == "L") {
      document.getElementById("div-respuesta").style.display = "none";
      document.getElementById("guardar_pregunta").style.display = "initial";
    }
  }

  function saveRespuesta() {
    var flagMo = sessionStorage.getItem("flagMo");

    if (flagMo == "off") {
      mo = "on";
      sessionStorage.setItem("flagMo", mo);

      //obtengo id pregunta de la última pregunta guardada (es la anterior a la actual)
      var id_pregunta = sessionStorage.getItem("id-pregunta");
      Number.parseInt(id_pregunta);
      id_pregunta++;
      sessionStorage.setItem("id-pregunta", id_pregunta.toString());
    } else {
      //obtengo id pregunta de la última pregunta guardada (ya se guardó para esta pregunta)
      var id_pregunta = sessionStorage.getItem("id-pregunta");
      Number.parseInt(id_pregunta);
    }

    document.getElementById("div-respuesta").style.display = "none";
    document.getElementById("add-respuesta").style.display = "initial";
    document.getElementById("guardar_pregunta").style.display = "initial";
    // document.getElementById("tipo-respuesta").value = "L";
    document.getElementById("texto-pregunta").disabled = true;
    document.getElementById("tipo-respuesta").disabled = true;

    //obtengo respuestas guardadas
    var respuestas_memoria_str = localStorage.getItem("respuestas");
    var respuestas_memoria = JSON.parse(respuestas_memoria_str);

    if (respuestas_memoria === null) {
      respuestas_memoria = [{}];
    }

    //nueva respuesta a guardar en memoria
    var texto_respuesta = document.getElementById("texto-respuesta").value;

    var respuesta = {
      id_pregunta: Number.parseInt(id_pregunta),
      texto_respuesta: texto_respuesta,
    };

    //agrego item a colección
    respuestas_memoria.push(respuesta);

    //guardo array en memoria
    localStorage.setItem("respuestas", JSON.stringify(respuestas_memoria));

    document.getElementById("texto-respuesta").value = "";

    //armo div para despliegue (html dinámico)
    let visor_respuestas = document.getElementById("visor-respuestas");
    
    let respuesta_ingresada_span = document.createElement("span");
    respuesta_ingresada_span.innerHTML = respuesta["texto_respuesta"];
    respuesta_ingresada_span.setAttribute("class","respuesta-ingresada-span");

    let respuesta_ingresada = document.createElement("div");
    respuesta_ingresada.setAttribute("class", "respuesta-ingresada rounded");

    respuesta_ingresada.appendChild(respuesta_ingresada_span);
    visor_respuestas.appendChild(respuesta_ingresada);

  }

  function savePregunta() {
    //obtengo id pregunta
    var flagMo = sessionStorage.getItem("flagMo");

    if (flagMo == "off") {
      var id_pregunta = sessionStorage.getItem("id-pregunta");
      Number.parseInt(id_pregunta);
      id_pregunta++;
      sessionStorage.setItem("id-pregunta", id_pregunta.toString());
    } else {
      var id_pregunta = sessionStorage.getItem("id-pregunta");
      Number.parseInt(id_pregunta);
    }

    //obtengo las preguntas guardadas en memoria
    var preguntas_memoria_str = localStorage.getItem("preguntas");
    var preguntas_memoria = JSON.parse(preguntas_memoria_str);

    //si no existe array lo creo
    if (preguntas_memoria === null) {
      preguntas_memoria = [{}];
    }

    //valores de nueva pregunta
    var texto_pregunta = document.getElementById("texto-pregunta").value;
    var combo = document.getElementById("tipo-respuesta");
    var tipo_respuesta = combo.options[combo.selectedIndex].value;

    //armo objeto pregunta
    var pregunta = {
      id_pregunta: Number.parseInt(id_pregunta),
      texto: texto_pregunta,
      tipo_respuesta: tipo_respuesta,
    };

    //agregar pregunta actual a colección memoria
    preguntas_memoria.push(pregunta);

    localStorage.setItem("preguntas", JSON.stringify(preguntas_memoria));
  }
</script>
